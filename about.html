<!DOCTYPE html>
<html lang="en">
<head>
  <title>Brexit on Blockchain</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="main.js"></script>
  <style>
      p {
        font-size: 20px;
      }

       xmp {
        font-size: 20px;
      }
      </style>




</head>
<body style="background-image: url('./images/ocean.jpg')">
 
    
    <nav class="navbar">
        <a class="navbar-brand" href="#">
          <img src="/images/heartbreak-brexit-256.png" width="200" height="200" class="d-inline-block" alt="">
          <strong style="font-size:200%"> Brexit on Blockchain</strong> 
        </a>
        <nav class="nav">
            <a class="nav-link active" style="font-size:150%" href="./index.html">Home</a>
            <a class="nav-link" style="font-size:150%" href="#">About</a>
            <a class="nav-link" style="font-size:150%" href="https://faucet.dimensions.network">Ropsten Faucet</a>
          </nav>
      </nav>

      <div class="container-fluid">
        <div class="row ">
          <div class="col col-sm-4 offset-sm-2 text-primary">
            <H1>Peoples Vote</H1>
            <H4> Revisting the brexit referendum on the Blockchain</H4>
            <p>This Dapp revisits the UK referendum on leaving the European Union.
              By utilizing the ethereum public blockchain the votes are transparent, tamper proof and censorship resistant.
            </p>
            <h4>Dapp and Smart Contract Details</h4>
            <p>The Meta Mask wallet is required to interact with this dapp. It can be installed by following this <a href="https://metamask.io/">link</a>. 
              The smartcontact is currently deployed to the Ethereum Ropsten test network, hence Ropsten Ether is required to pay for the gas fees to 
              voting or donate. Ropsten ether is free and can be obtained by following this <a href="https:.  //faucet.dimensions.network"> link</a>. 
            </p>
            <P>
              The Dapp allows a single vote per address. Donations are accepted and allocated to Remain or Leave. 
              The contract owner address cannot withdrawal the funds only allocate assignment to the nominated remain or leave wallet address. 
              At this time given the contract resides on the test network, ropsten Ether will be used to test furture projects. 
            </P>
            <h4>Further Improvements</h4>
            <p>
            -Allocate a time limit for the vote<br>
            -Allocate a time limit after vote concludes for the withdrawals from the nominated leave or remain parties<br>
            -After withdrawal time limit exceeds, if the balances have not been withdrawwn by the parties, return ownership of the funds back to the address of the donator.
            </p>

          </div>
          <div class="col col-sm-4 text-primary">
            <h1>Solidity Code</h1>
                <xmp>
                    pragma solidity 0.4.25;

                    contract brexit {
                        // Model remain or leave
                        struct Option {
                            uint id;
                            string name;
                            uint voteCount;
                        }
                    
                        // Store accounts that have voted
                        mapping(address => bool) public voters;
                        // Store options
                        // Fetch options
                        mapping(uint => Option) public Options;
                        // Store Candidates Count
                        uint public optionCount;
                        address public contractOwner;
                        address public leaveOwner;
                        address public remainOwner;
                        uint256 public remainTotal;
                        uint256 public leaveTotal;
                    
                        // voted event
                        event votedEvent (
                            uint indexed _optionId
                        );
                        
                        event ownerChangeEvent ( address _newOwner, uint _optionId );
                    
                        constructor () public {
                            contractOwner = msg.sender;
                            addOption("Leave");
                            addOption("Remain");
                        }
                    
                        function addOption (string _LeaveOrRemain) private {
                            optionCount ++;
                            Options[optionCount] = Option(optionCount, _LeaveOrRemain, 0);
                        }
                    
                        function vote (uint _optionId) public {
                            // require that they haven't voted before
                            require(!voters[msg.sender]);
                    
                            // require a valid candidate
                            require(_optionId > 0 && _optionId <= optionCount);
                    
                            // record that voter has voted
                            voters[msg.sender] = true;
                    
                            // update candidate vote Count
                            Options[_optionId].voteCount ++;
                    
                            // trigger voted event
                            emit votedEvent(_optionId);
                        }
                    
                    // function donate to the respective campaign remain or leave
                        function donate(uint _optionId) payable public {
                            require(_optionId > 0 && _optionId <= optionCount);
                            // amount += msg.value;
                            if(_optionId == 1) {
                                leaveTotal += msg.value;
                            } else if (_optionId == 2) {
                                remainTotal += msg.value; 
                            }
                        }
                    
                        function changeOwner(address _newOwner,uint _optionId) public {
                            require(contractOwner == msg.sender);
                             if(_optionId == 1) {
                                leaveOwner = _newOwner;
                                emit ownerChangeEvent(_newOwner, _optionId);
                            } else if (_optionId == 2) {
                                remainOwner = _newOwner;
                                emit ownerChangeEvent(_newOwner, _optionId);
                            }
                        }
                    
                        function withdrawLeave(uint _amount) public {
                            require(leaveOwner == msg.sender);
                            require(_amount <= leaveTotal);
                            leaveTotal -= _amount;
                            msg.sender.transfer(_amount);
                        }
                    
                    
                    }  
                </xmp>
          </div>
        </div>
      </div>
  


</body>
</html>